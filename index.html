function scaleAndCenterCanvas() {
  const canvas = document.querySelector('canvas');
  if (!canvas) return;

  const nativeWidth = canvas.width;
  const nativeHeight = canvas.height;

  if (nativeWidth === 0 || nativeHeight === 0) {
    return false;
  }

  const scaleX = window.innerWidth / nativeWidth;
  const scaleY = window.innerHeight / nativeHeight;
  const scale = Math.min(scaleX, scaleY);

  canvas.style.width = nativeWidth + 'px';
  canvas.style.height = nativeHeight + 'px';
  canvas.style.position = 'absolute';
  canvas.style.transformOrigin = 'left top';
  canvas.style.transform = `scale(${scale})`;

  // CENTER the canvas both horizontally and vertically
  const offsetX = (window.innerWidth - nativeWidth * scale) / 2;
  const offsetY = (window.innerHeight - nativeHeight * scale) / 2;
  canvas.style.left = offsetX + 'px';
  canvas.style.top = offsetY + 'px';

  return { scale, offsetX, offsetY };
}

function fixMouseCoords(e, scale, offsetX, offsetY) {
  const x = (e.clientX - offsetX) / scale;
  const y = (e.clientY - offsetY) / scale;
  return { x, y };
}

function setupInputFix() {
  const canvas = document.querySelector('canvas');
  if (!canvas) return;

  let last = { scale: 1, offsetX: 0, offsetY: 0 };

  function update() {
    const res = scaleAndCenterCanvas();
    if (res) last = res;
  }

  update();
  window.addEventListener('resize', update);

  ['mousemove', 'mousedown', 'mouseup', 'click'].forEach(eventName => {
    canvas.addEventListener(eventName, e => {
      const fixed = fixMouseCoords(e, last.scale, last.offsetX, last.offsetY);

      // If you have access to the game's input system, send fixed.x and fixed.y here
      // Otherwise, this only logs corrected coords for debugging:
      console.log(`Corrected ${eventName}: x=${fixed.x.toFixed(2)}, y=${fixed.y.toFixed(2)}`);

      // Optionally stop propagation to prevent wrong coordinates reaching game:
      // e.stopPropagation();
      // e.preventDefault();
    }, { passive: false });
  });
}

window.addEventListener('load', () => {
  const trySetup = () => {
    if (document.querySelector('canvas')) {
      setupInputFix();
    } else {
      setTimeout(trySetup, 100);
    }
  };
  trySetup();
});
